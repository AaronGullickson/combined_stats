# Measuring Association

------

## The Two-Way Table

The **two-way table** (also known as a **cross-tabulation** or **crosstab**) gives the joint distribution of two categorical variables. Lets use our politics dataset to construct a two-way table of belief in anthropogenic climate change by political party:

```{r}
tab <- table(politics$party, politics$globalwarm)
tab
```

The two-way table gives us the **joint distribution** of the two variables, which is the number of respondents who fell into both categories. For example, we can see that 234 democrats did not believe in anthropogenic climate change while 1230 did. 

From this table, we can also calculate the **marginal distribution** of each of the variables, which are just the distributions of each of the variables separately. We can do that by adding up across the rows and down the columns:

```{r echo=FALSE}
row.margin <- paste(tab[,1],"+",tab[,2],"=",tab[,1]+tab[,2],sep="")
col.margin <- c(paste(tab[1,],"+",tab[2,],"+",tab[3,],"+",tab[4,],"=",tab[1,]+tab[2,]+tab[3,]+tab[4,],sep=""), sum(tab))
tab.full <- cbind(tab, row.margin)
tab.full <- rbind(tab.full, col.margin)
colnames(tab.full) <- c("Deniers", "Believers", "Total")
rownames(tab.full) <- c(rownames(tab)[1:4], "Total")
set.alignment(c("right","right","right"))
emphasize.italics.rows(5)
emphasize.italics.cols(3)
pander(tab.full)
```

The marginal distribution of party affiliation is given by the Total column on the right and the marginal distribution of climate change belief is given by the Total row at the bottom. Looking at the column marginal, we can see that there were a total of 1464 Democrats, 1239 Republicans, and so on. Looking at the row marginal, we can see that there were 1181 anthropogenic climate change deniers and 3057 anthropogenic climate change believers. The final number (4238) in the far right corner is the total number of respondents altogether. You can get this number by summing up the column marginals (1181+3057) or row marginals (1464+1239+1383+152). 

The `margin.table` command in *R* will also calculate marginals for us. I can use the `margin.table` command on the table I created and saved above as *tab*  to calculate the same marginals as above. Note that you need to indicate which marginal you want by a number, where 1=row and 2=column, as the second option to `margin.table`:

```{r}
margin.table(tab,1)
margin.table(tab,2)
```

The two-way table provides us with evidence about the association between two categorical variables. To understand what the association looks like, we will learn how to calculate **conditional distributions**. 

### Conditional distributions

To this point, we have learned about the **joint** and **marginal** distributions in a two-way table. In order to look at the relationship between two categorical variables, we need to understand a third kind of distribution: the **conditional distribution**. The conditional distribution is the distribution of one variable conditional on being in a certain category of the other variable. In a two-way table, there are always two ways to calculate a conditional distribution. In our case, we could look at the distribution of climate change belief conditional on party affiliation, or we could look at the distribution of party affiliation conditional on climate change belief. Both of these distributions really give us the same information about the association, but sometimes one way is more intuitive to understand. In this case, I am going to start with the former case and calculate the distribution of climate change belief conditional on party affiliation.

This conditional distribution is basically given by the rows of our two-way table, which give the number of individuals of a given party who fall into each belief category. For example, the distribution of denial/belief among Democrats is 429 and 1932, while among Republicans, this distribution is 708 and 681. However, these two rows are not directly comparable as they are because Republicans are a much smaller group than Democrats. Thus, even if the shares were very different between the two groups, the absolute numbers for Republicans would probably be smaller for both categories. In order to make these rows comparable, we need the proportion of each party that falls into each belief category. In order to do that, we need to divide our rows through by the marginal distribution of party affiliation, like so: 

```{r echo=FALSE}
row.margin <- margin.table(tab,1)
row.margin <- t(matrix(rep(row.margin, each=2),2,4))
tab.cond <- matrix(paste(tab, row.margin, sep="/"), dim(tab))
tab.cond <- cbind(tab.cond, row.margin[,1])
rownames(tab.cond) <- rownames(tab)
colnames(tab.cond) <- c("Deniers","Believers","Total")
set.alignment(c("right","right","right"))
pander(tab.cond)
```

Note that each row gets divided by its row marginal. If we do the math here, we will come out with the following proportions:

```{r echo=FALSE}
tab.prop <- round(prop.table(tab,1),4)
tab.prop <- cbind(tab.prop,rep(1,4))
colnames(tab.prop) <- c("Deniers","Believers","Total")
set.alignment(c("right","right","right"))
pander(tab.prop)
```

Note that the proportions should add up to 1 within each row because we are basically calculating the share of each row that belongs to each column category. **To understand these conditional distributions, you need to look at the numbers within each row.** For example, the first row tells us that 16% of Democrats are deniers and 84% of Democrats are believers. The second row tells us that 46% of Republicans are deniers and 54% of Republicans are believers.

We can tell if there is an association between the row and column variable if these conditional distributions are different across rows. In this case, they are clearly very different. About 84% of Democrats are believers while only about half (54%) of Republicans are believers. About 76% of Independents are believers, while about 68% of members of other parties are believers. 

We can use the `prop.table` command we saw in the last module to estimate these conditional distributions. In order to do that we feed in the crosstab we calculated with tab and one additional argument that indicates which dimension (row or column ) we want to condition across. Like `margin.table` a value of `1` will condition on rows (rows sum to 1) and a value of `2` will condition on columns (columns sum to 1). If we condition on rows here, we will get the same table as above.  

```{r}
prop.table(tab,1)
```

Its important to remember which way you did the conditional distribution and get the interpretation correct. If you are not sure, just note which way the proportions add up to one - this is the direction you should be looking (i.e. within row or column). In this case, I am looking at the distribution of variables within rows, so the proportions refer to the proportion of respondents from a given political party who hold a given belief. But, I could have done my conditional distribution the other way:

```{r}
prop.table(tab,2)
```

Note that this table looks deceptively similar to the table above. But look again. The numbers now don't add up to one within each row. They do however add up to one within each column. In order to read this table properly, we have to understand that it is giving us the distribution within each column: the proportion of respondents who have a given belief who belong to a given political party. So we can see in the first number that 19.8% of deniers are Democrats, 48.2% are Republicans, 27.9% are Independents, and 4.1% belong to other parties. This distribution is very different from the party affiliation distribution of believers in the second column which tells us that there is an association. However, the large party cleavages on the issue are not as immediately obvious here as they were with the previous conditional distribution. Always think carefully about which conditional distribution is more sensible to interpret and always make sure that you are interpreting them in the correct way. 

It is also possible to graph the conditional distribution as a set of barplots. First, lets save the output of our prop.table into a new object.

```{r}
distBeliefByParty <- prop.table(tab,1)
```

We can then use the `barplot` command to graph these distributions. However, there is one "gotcha" that we need to be aware of when running this command. When looking at conditional distributions across rows, barplot will misinterpret our data because it expects it to be oriented so things sum to one down the columns. We can however easily fix this with the `t` command ("t"" for "transpose"") which rotates our results:

```{r barplot_climatebelief, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
barplot(t(distBeliefByParty), legend.text=c("Denial", "Belief"), las=1, cex.names=0.8)
```

Note that when we use barplot like this, it gives us each party in one bar and then shades the bar to show the share of each response. I have used the legend.text option here to indicate which shading belongs to which category. 

Another option is to graph the bars for each category next to each other and grouped by party. You can do this with the `beside` option which you set to TRUE: 

```{r braplot_climatebelief_beside, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
barplot(t(distBeliefByParty), beside=TRUE, las=1, col=c("darkgreen","yellow"), cex.names=0.8)
legend(4, 0.8, legend=c("Denial","Belief"), fill=c("darkgreen","yellow"), bty="n")
```

In this case, I have also added custom colors for the two categories and designed my own legend that I can place better than the automated one. 

### Odds ratio

We can also use the **odds ratio** to measure the association between two categorical variables.  The odds ratio is not a term that is common in everyday speech but it is a critical concept in all kinds of scientific research. 

Lets take the different distributions of climate change belief for Democrats and Republicans. About 84% of Democrats were believers, but only 54% of Republicans were believers. How can we talk about how different these two numbers are from one another? We could subtract one from the other or we could take the ratio by dividing one by the other. However, both of these approaches have a major problem. Because the percents (and proportions) have minimum and maximum values of 0 and 100, as you approach those boundaries the differences necessarily have to shrink because one group is hitting its upper or lower limit. This makes it difficult to compare percentage or proportional differences across different groups because the overall average proportion across groups will affect the differences in proportion.

Odds ratios are a way to get around this problem. To understand odds ratios, you first have to understand what odds are. All probabilities (or proportions) can be converted to a corresponding odds. If you have a $p$ probability of success on a task, then your odds $O$ of success are given by:

$$O=\frac{p}{1-p}$$

The odds are basically the ratio of the probability of success to the probability of failure. This tells you how many successes you expect to get for every one failure. Lets say a baseball player gets a hit 25% of the time that the player comes up to bat (an average of 250). The odds are then given by:

$$O=\frac{0.25}{1-0.25}=\frac{0.25}{0.75}=0.33333$$

The hitter will get on average 0.33 hits for every one out. Alternatively, you could say that the hitter will get one hit for every three outs. 

Re-calculating probabilities in this way is useful because unlike the probability, the odds has no upper limit. As the probability of success approaches one, the odds will just get larger and larger.

We can use this same logic to construct the odds that a Democratic and Republican respondent, respectively, will be climate change believers. For the Democrat, the probability is 0.84, so the odds are:

$$O=\frac{0.84}{1-0.84}=\frac{0.84}{0.16}=5.250$$

Among Democrats, there are 5.25 believers for every one denier. Among Republicans, the probability is 0.541, so the odds are:

$$O=\frac{0.541}{1-0.541}=\frac{0.541}{0.459}=1.179$$

Among Republicans, there are 1.17 believers for every one denier. This number is close to "even" odds of 1, which happen when the probability is 50%. 

The final step here is to compare those two odds. We do this by taking their **ratio**, which means we divide one number by the other:

$$\frac{5.25}{1.179}=4.45$$

This is our odds ratio. How do we interpret it? This odds ratio tells us how much more or less likely climate change belief is among Democrats relative to Republicans. In this case, I would say that "the odds of belief in anthropogenic climate change are 4.45 times higher among Democrats than Republicans." Note the "times" here. This 4.45 is a multiplicative factor because we are taking a ratio of the two numbers. 

You can calculate odds ratios from conditional distributions just as I have done above, but there is also a short cut technique called the **cross-product**. Lets look at the two-way table of party affiliation but this time just for Democrats and Republicans. For reasons I will explain below, I am going to reverse the ordering of the columns so that believers come first. 

```{r echo=FALSE}
tab <- cbind(c(1230,670),c(234,569))
colnames(tab) <- c("Believer","Denier")
rownames(tab) <- c("Democrat","Republican")
set.alignment(c("right","right"))
emphasize.strong.cells(rbind(c(1,1),c(2,2)))
emphasize.italics.cells(rbind(c(1,2),c(2,1)))
pander(tab)
```

The two bolded numbers are called the **diagonal** and the two italicized numbers are the **reverse diagonal**. The cross-product is calculated by multiplying the two numbers in the diagonal by each other and multiplying the two numbers in the reverse diagonal together and then dividing the former product by the latter:

$$\frac{1230*569}{670*234}=4.46$$

I get the exact same odds ratio as above (except for rounding error), without having to calculate the proportions and odds themselves. This is a useful shortcut for calculating odds ratios. There is one thing to keep in mind, however. The odds ratio that you calculate is always the odds of the first row being in the first column relative to those odds for the second row. Its easy to show how this would be different if I had kept the original ordering of believers and deniers:

```{r echo=FALSE}
tab <- cbind(tab[,2],tab[,1])
colnames(tab) <- c("Denier","Believer")
rownames(tab) <- c("Democrat","Republican")
set.alignment(c("right","right"))
emphasize.strong.cells(rbind(c(1,1),c(2,2)))
emphasize.italics.cells(rbind(c(1,2),c(2,1)))
pander(tab)
```

$$\frac{234*670}{569*1230}=0.22$$

I get a very different odds ratio, but that is because I am calculating something different. I am now calculating the odds ratio of being a denier rather than a believer. So I would say that the "the odds of denial of anthropogenic climate change among Democrats are only 22% of the odds for Republicans." In other words, the odds of being a denier are much lower among Democrats. 

Note, however, that the information here is the same because the 0.22 here is exactly equal to 1/4.46. In other words, the odds ratio of denial is just the inverted mirror image of the odds ratio of belief. Its just important that you remember that when you calculate the cross-product, you are always calculating the odds ratio of being in the category of the first column, whatever category that may be. 

------

## Mean Differences

Measuring association between a quantitative and categorical variable is fairly straightforward. We want to look for differences in the distribution of the quantitative variable at different categories of the categorical variables. For example, if we were interested in the gender wage gap, we would want to compare the distribution of wages for women to the distribution of wages for men. There are two ways we can do this. First, we can graphically examine the distributions using the techniques we have already developed, particularly the boxplot. Second, we can compare summary measures like the mean across categories.

### Graphically examining differences in distributions

We could compare entire histograms of the quantitative variable across different categories of the categorical variable, but this is often too much information. A cleaner method is to use **comparative boxplots**. Comparative boxplots construct boxplots of the quantitative variable across all categories of the categorical variable and plot them next to each other for easier comparison. Here is an example looking at differences in movie runtime across different movie genres.

```{r compar_box_runtime_genre, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
boxplot(Runtime~Genre, data=movies, col="seagreen", ylab="movie runtime in minutes", las=2)
```

This command introduces a new syntax. The tilde ("~") in the syntax above allows us to relate one variable to another. In this context, it tells the boxplot command to plot separate boxplots of runtime by the categories of genre. 

Comparative boxplots are useful because they allow us to easily compare differences in both the center and spread of distributions at the same time.  The thick bars give us an indication of the median movie runtime for each genre. Here we can clearly see that animated and horror movies have the lowest median runtimes and that mysteries have the longest median runtimes. We can also see that while there is significant variation, some genres like romance, scifi/fantasy, and thriller all have similar median runtimes. 

However, the boxplot also reveals additional information on the spread of runtimes for each genre. This is easiest to see by comparing the height of the boxes (the interquartile range) across genres. In particular, we can see that scifi/fantasy, action, and dramas have the largest variation in movie runtime, while horror and animated movies have very small variation. Clearly, there is more consensus about the appropriate length of horror and animated movies, than there is about action, drama, and scifi/fantasy movies. 

### Comparing differences in the mean

We can also establish a relationship by looking at differences in summary measures. Implicitly, we are already doing this in the comparative boxplot when we look at the median bars across categories. However, in practice it is more common to compare the mean of the quantitative variable across different categories of the categorical variable. In *R*, you can get the mean of one variable at different levels of a categorical variable using the `tapply` command like so:

```{r}
tapply(movies$Runtime, movies$Genre, mean)
```

The `tapply` command takes three options. The first option is the quantitative variable for which we want means. The second option is the categorical variable. The third option is the method we want to run on the quantitative variable, in this case the mean. The output is the mean movie runtime by genre.

We can also display these results graphically using barplots. To make this prettier, I am first going to sort the output from largest to smallest mean runtime:

```{r mean_barplot_runtime_genre, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
mruntime <- tapply(movies$Runtime, movies$Genre, mean)
mruntime <- sort(round(mruntime,1), decreasing=TRUE)
par(mar=c(7,4,4,2),las=2)
b <- barplot(mruntime, col="skyblue", ylab="movie runtime in minutes", ylim=c(0,125))
text(b[,1],mruntime+4,label=paste(mruntime), cex=0.7)
```

Now we can see very clearly how mean movie runtimes compare across different genres. We can also easily calculate the mean difference in movie length across any two genres. For example, lets say we are interested in the difference between action movies (111.9 minutes, on average) and horror movies (97.4 minutes, on average).

$$111.9-97.4=14.5$$

Action movies are, on average, 15 minutes longer than horror movies.

------

## Scatterplot and Correlation Coefficient

The techniques for looking at the association between two quantitative variables are more developed than the other two cases, so we will spend more time on this topic. Additionally, the major approach here of ordinary least squares regression turns out to be a very flexible, extendable method that we will build on later in the term.

When examining the association between two quantitative variables, we usually distinguish the two variables by referring to one variable as the **dependent variable** and the other variable as the **independent variable**. The dependent variable is the variable whose outcome we are interested in predicting. The independent variable is the variable that we treat as the predictor of the dependent variable. For example, lets say we were interested in the relationship between income inequality and life expectancy. We are interested in predicting life expectancy by income inequality, so the dependent variable is life expectancy and the independent variable is income inequality. 

The language of dependent vs. independent variable is causal, but its important to remember that we are only measuring the association. That association is the same regardless of which variable we set as the dependent and which we set as the independent. Thus, the selection of the dependent and independent variable is more about which way it more intuitively makes sense to interpret our results.

### The scatterplot

We can examine the relationship between two quantitative variables by constructing a **scatterplot**. A scatterplot is a two-dimensional graph. We put the independent variable on the x-axis and the dependent variable on the y-axis. For this reason, we often refer generically to the independent variable as x and the dependent variable generically as y. 

To construct the scatterplot, we plot each observation as a point, based on the value of its independent and dependent variable. For example, lets say we are interested in the relationship between the median age of the state population and violent crime in our crime data. Our first observation, Alabama, has a median age of 37.8 and a violent crime rate of 378 crimes per 100,000. We can plot this point on our graph as follows:

```{r scatter_onepoint, echo=FALSE, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
plot(crimes$MedianAge[1],crimes$Violent[1],
     xlim=c(min(crimes$MedianAge),max(crimes$MedianAge)),
     ylim=c(min(crimes$Violent),max(crimes$Violent)),
     xlab="Median Age",
     ylab="Violent crimes (per 100,000)",
     main="Scatterplot of Median Age and Violent Crime",
     pch=21, bg="red",las=1)
text(crimes$MedianAge[1],crimes$Violent[1],
     label=paste(crimes$State[1],"\n(",
                 round(crimes$MedianAge[1],1),",",
                 round(crimes$Violent[1],0),")",sep=""),
                 pos=4, cex=0.8)
```

If I repeat that process for all of my observations, I will get a scatterplot that looks like:

```{r scatter_age_violent, echo=FALSE, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
plot(crimes$MedianAge,crimes$Violent,
     xlim=c(min(crimes$MedianAge),max(crimes$MedianAge)),
     ylim=c(min(crimes$Violent),max(crimes$Violent)),
     xlab="Median Age",
     ylab="Violent crimes (per 100,000)",
     main="Scatterplot of Median Age and Violent Crime",
     pch=21, bg="red",las=1)
text(crimes$MedianAge,crimes$Violent,
     label=paste(crimes$State),
                 pos=4, cex=0.8)
```

It is not necessary to show the names of states here, but I have done so here in order to identify individual observations. 

What are we looking for when we look at a scatterplot? There are four important questions we can ask of the scatterplot. First, what is the **direction** of the relationship. We refer to a relationship as **positive** if both variables move in the same direction. if y tends to be higher when x is higher and y tends to be lower when x is lower, then we have a positive relationship. On the other hand, if the variables move in opposite directions, then we have a **negative** relationship.  If y tends to be lower when x is higher and y tends to be higher when x is lower, then we have a negative relationship. In the case above, it seems like we have a generally negative relationship. States with higher median age tend to have lower violent crime rates.

Second, is the relationship **linear**? I don't mean here that the points fall exactly on a straight line (which is part of the next question) but rather does the general shape of the points appear to have any "curve" to it. If it has a curve to it, then the relationship would be non-linear. This issue will become important later, because our two primary measures of association are based on the assumption of a linear relationship. In this case, there is no evidence that the relationship is non-linear.

Third, what is the **strength** of the relationship. If all the points fall exactly on a straight line, then we have a very strong relationship. On the other hand, if the points form a broad elliptical cloud, then we have a weak relationship. In practice, in the social sciences, we never expect our data to conform very closely to a straight line. Judging the strength of a relationship often takes practice. I would say the relationship above is of moderate strength.

Fourth, are there **outliers**? We are particularly concerned about outliers that go against the general trend of the data, because these may exert a strong influence on our later measurements of association. In this case, there are two clear outliers, Washington DC and Utah. Washington DC is an outlier because it has an extremely high level of violent crime relative to the rest of the data. Its median age tends to be on the younger side, so its placement is not inconsistent with the general trend. Utah is an outlier that goes directly against the general trend because it has one of the lowest violent crime rates and the youngest populations. This is, of course, driven by Utah's heavily Mormon population, who both have high rates of fertility (leading to a young population) and whose church communities are able to exert a remarkable degree of social control over these young populations.

#### Constructing scatterplots in *R*

You can construct scatterplots in *R* with the `plot` command. At a very basic level, you can just feed in the independent and dependent variables:

```{r scatter_basic1, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
plot(crimes$Poverty, crimes$Property)
```

We can improve on this command with our usual bells and whistles to label x and y axes, titles, etc. We can also use the `pch` option to define different dots for our points. If you pull up the help command `?points`, it will show a list of codes for all the different points you can use. I like to use `pch=21` because it will draw circles where you can color in both the center and the border. For example:

```{r scatter_basic2, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
plot(crimes$Poverty, crimes$Property, 
     xlab="Poverty rate", ylab="Property crime rate", 
     main="scatterplot of poverty rate and property crime", 
     las=1, pch=21, bg="orange", col="blue")
```

Sometimes with large datasets, scatterplots can be difficult to read because of the problem of **overplotting**. This happens when many data points overlap, so that its difficult to see how many points are showing. For example:

```{r scatter_overplot, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
plot(movies$Runtime, movies$TomatoMeter, pch=21, bg="grey", col="grey", las=1,
     xlab="movie runtime", ylab="Tomato Meter")
```

Because so many movies are in that 90-120 minute range it is difficult to distinguish them and thus a little tricky to summarize the relationship. There are more advanced ways we can address this issue, but these are beyond our introductory class. 

Overplotting can also be a problem with discrete variables because these variables can only take on certain values which will then exactly overlap with one another. For example:

```{r scatter_overplot2, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
plot(sex$educ, sex$sexf,
     xlab="years of education", ylab="sexual frequency")
```

Both of these variables are discrete and thus only take certain values, so all we see on the graph is more or less every possible point based on the possible values of education and sexual frequency. Multiple points are plotted directly on top of each other. We can fix this issue more easily by applying the `jitter` command which just adds a random amount to each observation so they don't exactly overlap. You often have to experiment with `jitter` to find just how much randomness (the second option) you have to apply. 

```{r scatter_jitter, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
plot(jitter(sex$educ,5), jitter(sex$sexf,50), 
     xlab="years of education", ylab="sexual frequency",
     pch=21, bg="grey", col="grey")
```

In this case, because of the large number of observations we still have a lot of overplotting. 

### The correlation coefficient

We can measure the association between two quantitative variables with the correlation coefficient, *r*. The formula for the correlation coefficient is:

$$r=\frac{1}{n-1}\sum_{i=1}^n (\frac{x_i-\bar{x}}{s_x}*\frac{y_i-\bar{y}}{s_y})$$

That looks complicated, but lets break it down step by step. We will use the association between median age and violent crimes as our example.

The first step is to subtract the means from each of our x and y variables. This will give us the distance above or below the mean for each variable.

```{r}
diffx <- crimes$MedianAge-mean(crimes$MedianAge)
diffy <- crimes$Violent-mean(crimes$Violent)
```

The second step is to divide these differences from the mean of x and y by the standard deviation of x and y, respectively. 

```{r}
diffx.sd <- diffx/sd(crimes$MedianAge)
diffy.sd <- diffy/sd(crimes$Violent)
```

Now each of your x and y values have been converted from their original form into the **number of standard deviations above or below the mean**. This is often called **standarization**. By doing this, we have put both variables on the same scale and have removed whatever original units they were measured in (in our case, years of age and crimes per 100,000). 

The third step is to to multiply each converted value of x by each converted value of y. 

```{r}
product <- diffx.sd*diffy.sd
```

Why do we do this? First consider this scatterplot of our standardized x and y:

```{r scatter_r_standardized, echo=FALSE, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
cols <- c("red","blue")
par(mar=c(4,4,0.1,2))
plot(diffx.sd,diffy.sd,
     xlab="SDs from mean of x",  ylab="SDs from mean of y",
     pch=21, bg=cols[(product>0)+1],las=1)
abline(h=0,lty=2)
abline(v=0,lty=2)
text(c(-1.5,1.5),c(-1.5,1.5),labels="Positive",col="blue")
text(c(-1.5,1.5),c(1.5,-1.5),labels="Negative",col="red")
```

Points shown in blue have either both positive or both negative x and y values. When you take the product of these two numbers, you will get a positive product. This is evidence of a positive relationship. Points shown in red have one positive and one negative x and y value. When you take the product of these two numbers, you will get a negative product. This is evidence of a negative relationship.

The final step is to add up all this evidence of a positive and negative relationship and divide by the number of observations (minus one). 

```{r}
sum(product)/(length(product)-1)
```

This final value is our correlation coefficient. We could have also calculated it by using the `cor` command:

```{r}
cor(crimes$MedianAge, crimes$Violent)
```

How do we interpret this correlation coefficient? It turns out the correlation coefficient *r* has some really nice properties. First, the **sign** of *r* indicates the direction of the relationship. If *r* is positive, the association is positive. If *r* is negative, the association is negative. if *r* is zero, there is no association. 

Second, *r* has a **maximum** value of 1 and a **minimum** value of -1. These cases will only happen if the points line up exactly on a straight line, which never happens with social science data. However, it gives us some benchmark to measure the strength of our relationship.  Here are some simulated scatterplots with different *r* in order to help you get a sense of the strength of association for different values of *r*.

```{r correlations_stength, echo=FALSE, fig.width=5, fig.height=4, out.width='500px', out.height='400px', dpi=300}
library(MASS)
par(mfrow=c(4,3), xaxt="n", yaxt="n", mar=c(1,1,1,1))
r <- seq(from=0.0, length=12, by=0.09)
for(i in 1:length(r)) {
  plot(mvrnorm(300,c(0,0),Sigma=cbind(c(1,r[i]),c(r[i],1))),
       pch=21, bg="grey", main=paste("r =",r[i],sep=" "))
} 
```

Third, *r* is a **unitless** measure of association. It can be compared across different variables and different datasets in order to make a comparison of the strength of association. For example, the correlation coefficient between unemployment and violent crimes is 0.45. Thus, violent crimes are more strongly correlated with unemployment than with median age (0.44>0.30).  The association between median age and property crimes is -0.36, so median age is more strongly related to property crimes than violent crimes (0.36>0.30).  

There are some important cautions when using the correlation coefficient. First, the correlation coefficient will only give a proper measure of association when the underlying relationship is **linear**. if there is a non-linear (curved) relationship, then *r* will not correctly estimate the association. Second, the correlation coefficient can be affected by **outliers**. We will explore this issue of outliers and influential points more in later sections.  

------